jQuery((function($){let animationSpeed=0,initialLoad=!1,loggedIn=$(".tu-tab-settings .tu-toggle-section input#termageddon_usercentrics_disable_logged_in"),editor=$(".tu-tab-settings .tu-toggle-section input#termageddon_usercentrics_disable_editor"),admin=$(".tu-tab-settings .tu-toggle-section input#termageddon_usercentrics_disable_admin");const check=(elem,checked=!0)=>{console.log(elem,checked),elem.prop("checked",checked).attr("readonly",checked).trigger("change")};1===loggedIn.length&&loggedIn.off("change.tu").on("change.tu",(function(){($(this).is(":checked")||initialLoad)&&(check(editor,$(this).is(":checked")),check(admin,$(this).is(":checked")))})).trigger("change");let geolocationToggle=$("input#termageddon_usercentrics_toggle_geolocation"),policyToggles=$(".tu-tab-geolocation .tu-toggle-section input");1===geolocationToggle.length&&(geolocationToggle.off("change.tu").on("change.tu",(function(){$(this).is(":checked")?$(".tu-tab-geolocation .tu-section-settings > div").slideDown(animationSpeed):$(".tu-tab-geolocation .tu-section-settings > div").slideUp(animationSpeed)})).trigger("change"),policyToggles.off("change.tu").on("change.tu",(function(){policyToggles.is(":checked")?jQuery("#no-geolocation-locations-selected,#no-geolocation-locations-selected-top").slideUp(animationSpeed):jQuery("#no-geolocation-locations-selected").slideDown(animationSpeed)})).trigger("change")),animationSpeed=300,initialLoad=!0;let migrationButton=$("#run_settings_migration");1===migrationButton.length&&migrationButton.off("click.tu").on("click.tu",(function(){const embedCode=document.querySelector("#termageddon_usercentrics_embed_code").value,settingsIdMatch=embedCode.match(/data-settings-id="([^"]+)"/);if(!settingsIdMatch||!settingsIdMatch[1])return void alert("Unable to find settings ID in embed code. Please ensure your embed code section contains a data-settings-id attribute. Please contact our support team if would like assistance.");const settingsId=settingsIdMatch[1];document.querySelector("#termageddon_usercentrics_settings_id").value=settingsId,document.querySelector("#termageddon_usercentrics_embed_code").value=embedCode.replace('<link rel="preconnect" href="//privacy-proxy.usercentrics.eu">',"").replace('<link rel="preload" href="//privacy-proxy.usercentrics.eu/latest/uc-block.bundle.js" as="script">',"").replace('<script type="application/javascript" src="https://privacy-proxy.usercentrics.eu/latest/uc-block.bundle.js"><\/script>',"").replace(/<script.*id="usercentrics-cmp".*async>.*<\/script>/g,"").replace(/<script>uc.setCustomTranslations.*<\/script>/g,"").trim();const migrationMessage=$(".migration-message");migrationMessage.removeClass("tu-alert-error").addClass("tu-alert-success"),migrationMessage.find("strong").text("Conversion Complete"),migrationMessage.find("p.alert-description").html("The embed code has been converted to a settings ID. All custom scripts outside of the original embed code have been maintained.<br/></br>\n\t\t\t\t\t<strong><em>The changes have been submitted.</em></strong>"),$(".tab-content form input.button").click()}));const SNIPPET_CONSTANTS_ANIMATION_DURATION=300,SNIPPET_CONSTANTS_CARET_ROTATION={COLLAPSED:"rotate(0deg)",EXPANDED:"rotate(180deg)"},SNIPPET_CONSTANTS_SELECT2_OPTIONS={width:"100%",placeholder:"Select a service...",allowClear:!0},SNIPPET_CONSTANTS_DEFAULT_SERVICE_TEXT="New Script Snippet",snippetsContainer=$("#termageddon-script-snippets-container"),addSnippetButton=$(".termageddon-add-snippet"),template=$("#termageddon-script-snippet-template");function countScriptTags(textarea){const content=$(textarea).val()||"",matches=content.match(/<script/gi);return matches?matches.length:0}function updateScriptBadge($row){const $textarea=$row.find(".termageddon-script-textarea"),$badge=$row.find(".termageddon-snippet-badge"),count=countScriptTags($textarea[0]);count>0?($badge.text(`${count} script${1!==count?"s":""} identified`),$badge.addClass("termageddon-snippet-badge-success")):($badge.text("0 scripts identified"),$badge.removeClass("termageddon-snippet-badge-success"))}function updateServiceName($row){const $select=$row.find(".termageddon-singleselect"),$serviceName=$row.find(".termageddon-snippet-service-name"),selectedText=$select.find("option:selected").text();$serviceName.text($select.val()&&selectedText?selectedText:SNIPPET_CONSTANTS_DEFAULT_SERVICE_TEXT)}function toggleAccordion($header){const $content=$header.siblings(".termageddon-snippet-accordion-content"),$caret=$header.find(".termageddon-snippet-caret");$content.is(":visible")?($content.slideUp(SNIPPET_CONSTANTS_ANIMATION_DURATION,(function(){$(this).addClass("collapsed")})),$caret.css("transform",SNIPPET_CONSTANTS_CARET_ROTATION.COLLAPSED)):($content.removeClass("collapsed").slideDown(SNIPPET_CONSTANTS_ANIMATION_DURATION),$caret.css("transform",SNIPPET_CONSTANTS_CARET_ROTATION.EXPANDED))}function setAccordionState($content,$caret,isCollapsed){isCollapsed?($content.hide(),$caret.css("transform",SNIPPET_CONSTANTS_CARET_ROTATION.COLLAPSED)):($content.show(),$caret.css("transform",SNIPPET_CONSTANTS_CARET_ROTATION.EXPANDED))}function initAccordionRow($row){updateScriptBadge($row),updateServiceName($row);const $content=$row.find(".termageddon-snippet-accordion-content"),$caret=$row.find(".termageddon-snippet-caret");setAccordionState($content,$caret,$content.hasClass("collapsed"))}function initSelect2($element){const $targets=$element||$(".termageddon-singleselect");$targets.each((function(){$(this).hasClass("select2-hidden-accessible")||$(this).select2(SNIPPET_CONSTANTS_SELECT2_OPTIONS)}))}function getNextSnippetIndex(){let maxIndex=-1;return snippetsContainer.find(".termageddon-script-snippet-row").each((function(){const index=parseInt($(this).attr("data-index"),10);!isNaN(index)&&index>maxIndex&&(maxIndex=index)})),maxIndex+1}function updateIndexInAttribute($elem,attrName,oldIndex,newIndex,pattern){const attrValue=$elem.attr(attrName);if(!attrValue)return;let searchStr,replaceStr;return"_"===pattern?(searchStr=`_${oldIndex}_`,replaceStr=`_${newIndex}_`):"["===pattern&&(searchStr=`[${oldIndex}]`,replaceStr=`[${newIndex}]`),attrValue.includes(searchStr)?($elem.attr(attrName,attrValue.replace(searchStr,replaceStr)),attrValue):null}function reindexSnippets(){snippetsContainer.find(".termageddon-script-snippet-row").each((function(index){const $currentRow=$(this),oldIndex=parseInt($currentRow.attr("data-index"),10);isNaN(oldIndex)||oldIndex===index||($currentRow.attr("data-index",index),$currentRow.find("select, textarea, label").each((function(){const $elem=$(this),oldId=updateIndexInAttribute($elem,"id",oldIndex,index,"_");if(oldId){const $label=$currentRow.find(`label[for="${oldId}"]`);if($label.length){const newId=$elem.attr("id");$label.attr("for",newId)}}updateIndexInAttribute($elem,"name",oldIndex,index,"["),updateIndexInAttribute($elem,"for",oldIndex,index,"_")})),initAccordionRow($currentRow))}))}snippetsContainer.length&&(initSelect2(),snippetsContainer.find(".termageddon-script-snippet-row").each((function(){initAccordionRow($(this))}))),$(document).on("click.tu",".termageddon-snippet-accordion-header",(function(e){$(e.target).closest(".termageddon-remove-snippet").length||toggleAccordion($(this))})),$(document).on("change.tu select2:select.tu select2:clear.tu",".termageddon-singleselect",(function(){const $row=$(this).closest(".termageddon-script-snippet-row");updateServiceName($row)})),$(document).on("input.tu change.tu",".termageddon-script-textarea",(function(){const $row=$(this).closest(".termageddon-script-snippet-row");updateScriptBadge($row)})),addSnippetButton.length&&addSnippetButton.off("click.tu").on("click.tu",(function(e){e.preventDefault();const newIndex=getNextSnippetIndex();let templateHtml=template.html();if(!templateHtml)return void console.error("Template not found");templateHtml=templateHtml.replace(/\{\{INDEX\}\}/g,newIndex).replace(/\{\{INDEX_PLUS_ONE\}\}/g,newIndex+1);const $newRow=$(templateHtml);snippetsContainer.append($newRow);const $newSelect=$newRow.find(".termageddon-singleselect");initSelect2($newSelect),updateScriptBadge($newRow),updateServiceName($newRow);const $content=$newRow.find(".termageddon-snippet-accordion-content"),$caret=$newRow.find(".termageddon-snippet-caret");setAccordionState($content,$caret,!1)})),$(document).on("click.tu",".termageddon-remove-snippet",(function(e){if(e.preventDefault(),e.stopPropagation(),confirm("Are you sure you want to remove this script snippet? This action cannot be undone.")){const $row=$(this).closest(".termageddon-script-snippet-row");$row.remove(),reindexSnippets()}}))}));